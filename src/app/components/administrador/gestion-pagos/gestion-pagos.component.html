<mat-toolbar color="primary" class="mat-nav">
  <div class="toolbar-content">
    <div class="title">Gestión de Pagos</div>
    <div class="subtitle">Controla cobros, estados y registros</div>
  </div>
  <span class="spacer"></span>
  <button mat-flat-button color="accent" class="create-btn" (click)="openCreate()" aria-label="Crear pago">
    <mat-icon>payment</mat-icon>
    <span class="btn-label">Crear</span>
  </button>
</mat-toolbar>

<div class="container mat-elevation-z2">
  <div class="controls">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Buscar</mat-label>
      <input matInput [(ngModel)]="query" (input)="filter()" />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Concepto</mat-label>
      <mat-select [(value)]="selectedConcepto" (selectionChange)="filter()">
        <mat-option value="">Todos</mat-option>
        <mat-option value="Inscripcion">Inscripción</mat-option>
        <mat-option value="Mensualidad">Mensualidad</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Estado</mat-label>
      <mat-select [(value)]="selectedEstado" (selectionChange)="filter()">
        <mat-option value="">Todos</mat-option>
        <mat-option value="Pendiente">Pendiente</mat-option>
        <mat-option value="Pagado">Pagado</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div *ngIf="filtered.length === 0" class="empty-card">
    <mat-card>
      <mat-card-content>
        <h3>No hay pagos</h3>
        <p>No se encontraron registros con esos filtros.</p>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="list">
    <mat-card *ngFor="let p of filtered" class="mat-card-item">
      <mat-card-header>
        <mat-card-title>{{ p.matricula.estudianteNombre }} <small class="muted">#{{ p.matricula.matricula_id }}</small></mat-card-title>
        <mat-card-subtitle>{{ p.matricula.cursoNombre }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <p>Concepto: {{ p.concepto }}</p>
        <p>Monto: {{ p.monto | currency:'USD' }}</p>
        <p>Fecha: {{ p.fecha }}</p>
        <p>Estado: <strong>{{ p.estado }}</strong></p>
      </mat-card-content>
      <mat-card-actions>
        <button mat-stroked-button color="primary" *ngIf="p.estado === 'Pendiente'" (click)="markPaid(p)">Marcar pagado</button>
        <button mat-stroked-button color="warn" (click)="delete(p)">Borrar</button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Create dialog -->
  <ng-template #createDialog>
    <mat-card>
      <mat-card-title class="dialog-title">Crear Pago</mat-card-title>
      <mat-card-content>
        <mat-form-field appearance="fill" class="full">
          <mat-label>Matrícula (ID)</mat-label>
          <input matInput [(ngModel)]="newPago.matriculaId" type="number" />
        </mat-form-field>

        <mat-form-field appearance="fill" class="full">
          <mat-label>Concepto</mat-label>
          <mat-select [(ngModel)]="newPago.concepto">
            <mat-option value="Inscripcion">Inscripción</mat-option>
            <mat-option value="Mensualidad">Mensualidad</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill" class="full">
          <mat-label>Monto</mat-label>
          <input matInput [(ngModel)]="newPago.monto" type="number" />
        </mat-form-field>
      </mat-card-content>
      <mat-card-actions>
        <button mat-flat-button color="primary" (click)="create()">Crear</button>
        <button mat-stroked-button (click)="dialog.closeAll()">Cancelar</button>
      </mat-card-actions>
    </mat-card>
  </ng-template>
</div>
